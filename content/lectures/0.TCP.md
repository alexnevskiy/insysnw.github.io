+++
title = "Введение. TCP/IP."
template = "page.html"
+++

# Зачем нужны компьютерные сети?
Прежде чем погружаться в изучение компьютерных сетей, давайте сначала разберёмся, где компьютерные сети применяются.
Есть очевидные случаи, когда вы пользуетесь ими почти на прямую:

* Стриминговые сервисы, передающие на ваше устройство медиа контент (Netflix, Spotify, Яндекс музыка, Youtube, Twitch).
* Социальные сети и месенджеры (VK, Telegram, email, Element).
* Вэб порталы и магазины (Сайт гос услуг, Aliexpress).
* Он-лайн игры.
* Обновления ОС или программ.

Но есть и чуточку более абстрагированные случаи:

* Системы платежей (Visa, MasterCard, МИР)
* Телеметрия (счётчики, датчики)
* Удалённое управление (DJI Mavic (**TODO**: вспомнить как пишется), домофоны)

## Ожидания
Давайте ненадолго забудем, что мы тут обсуждаем сети и соберём наши ожидания от всех вышеперечисленных сервисов.

Оплачивая покупку банковской картой мы бы хотели действительно оплатить покупки, а не увидеть сообщение о решение банка взять перекур.
То есть нам хочется иметь **доступный** сервис.

Помимо самого факта оплаты, мы бы очень хотели, чтобы оплата прошла с первого раза и по указанной сумме.
Это свойство можно охарактеризовать как **надёжность**.

Думаю, многие предпочли бы использовать наличный расчет, если бы каждая оплата банковской картой занимала по 10 минут, поэтому мы ожидаем от такого сервиса **отзывчивости**.

Следующее ожидание на примере использования системы оплаты в качестве потребителя сложно прочувствовать.
Намного проще на него посмотреть со стороны банка.
У вас, как у потребителя услуг в банка одновременные взаимоотношения с единицами банков, а клиентов у банка могут быть миллионы.
Очень большое количество клиентов может провести какую-нибудь операцию примерно в одно время.
Чтобы сохранить репутацию надёжного банка, его сервисы должны быть достаточно **производительны**, чтобы обслужить всех.

Последнее, но самое важное из ожиданий - **совместимость**.
Почти наверняка ваша банковская карта работает более чем в одном магазине и банкомате.
Её принимают он-лайн площадкию
И всё её же можно подключить во многие телефоны и даже некоторые умные часы.

Всё это произошло не случайно.
Залогом успеха взаимодействия сложных систем является чёткое описание взаимодействий.
Одна из форм такого описания - протокол.

# Протоколы

В нашем случае под протоколом мы подразумеваем набор правил и действий (очерёдность действий), позволяющий осуществлять соединение и обмен данными между двумя и более включёнными в сеть устройствами.

Однако стоит быть аккуратным, когда описываете протокол.

Реализация
**TODO**: напилить годный пример

Интерфейс
**TODO**: напилить годный пример

# Основа современного интернета

Так как реализовать протокол для решения всех текущих и будущих задач вполне справедливо казалось невозможно.
Сетевые протоколы были разбиты на вложенные уровни (стэк).

Первой заментной инициативой по созданию такого разбиения была модель OSI (Open Systems Interconnection).

| Прикладной    | Application  |
| --            | --           |
| Представления | Presentation |
| Сеансовый     | Session      |
| Транспортный  | Transport    |
| Сетевой       | Network      |
| Канальный     | Data link    |
| Физический    | Physical     |


Пока шла длительная разработка OSI, что-то уже нужно было применять в реальном мире.
Именно в это время на сцену выходит актуальный и по сей день стек TCP/IP.

В нём были отброшены два уровня: представления и сеансовый.
Тем не менее, их отсутсвие в стеке не значит отсутствие проблем.
Так сеансовый уровень можно встретить в транспортном (протокол TCP, PPTP) и в прикладном (протокол HTTP).
А уровень представления ярко выражен в прикладном: шифрование - TLS, отображение - Unicode, сжатие - **TODO**: пример сжатия в прикладном уровне.

**TODO**: нужно ли разбирать уровни TCP?

| Прикладной        | Application      |
| --                | --               |
| ~~Представления~~ | ~~Presentation~~ |
| ~~Сеансовый~~     | ~~Session~~      |
| Транспортный      | Transport        |
| Сетевой           | Network          |
| Канальный         | Data link        |
| Физический        | Physical         |



# Сокеты

Дитя UNIX философии - "Всё файл"

. . .

- IPv4
- IPv6

. . .

*Unix, IR, Bluetooth, LoRa ...*

## IPv4

- Как адресовать другую машину?

. . .

- Как представлен адрес?

## Типы сокетов IPv4

::: notes

Рассказываем о том, о чём должен заботится программист на каждом уровне:

* TCP - просто посылаешь/получаешь данные.
* UDP - Ограничение размером пакета. Пакеты в сети теряются, перемешиваются и даже дублируются.
* RAW - Нет адресации прикладного уровня на транспортном (портов), checksum.

:::

- TCP (Transmission Control Protocol)
- UDP (User Datagram Protocol)
- RAW (совсем сырые) 

# TCP
::: notes

Пояснить какие механизмы обеспечивают такую беззаботность.

:::

Сессия
  общая инфа

## Установка TCP сессии

![](images/tcp_connection.png)

## Общение

## Плавающее окно (как расширение общения)

## Завершение TCP сессии

![](images/tcp_termination.png)


# Утечка ресурсов

Некоторые браузеры известны тем, что со временем поедают всё больше и больше оперативной памяти.

. . .

Сокеты тоже ресурс

## Пример проблемы незакрытия сокета

# Binding (address:port)
::: notes

Могут быть разные ресурсы, ибо биндятся они на разные адреса

:::

```
127.0.0.1:8080
127.0.0.2:8080
```

## Binding на всех адресах

```
0.0.0.0:8081
```

## Ограничения
::: notes

* Зарезервированные требуют прав
* Права хорошо бы дропать
* Их всё равно можно использовать как угодно
* Спросить почему последний именно 65535 (16 бит поля в заголовке)

:::

* 0-1023
* 1024-65535

