+++
title = "Неблокирующая обработка"
description = "Перенос ожидания клиентов на уровень ядра. Асинхронность."
draft = true
weight = 3
+++

# Проблемы блокирующего подхода

Реализовать блокирующий подход проще, но он сам по себе не масштабируется.
Для решения проблемы взаимодействия более чем с одним клиентом приходится прибегать к помощи Операционной Системы.
А именно к потокам.
Такое решение работает и делает это уверенно на относительно небольших объёмах клиентов.

Проблемы начинаются, когда количество подключений начитает измеряться тысячами и выше.
Оказывается использование по одному потоку на одного клиента - очень расточительно.
Переключение потоков - долгая операция и мы никак не можем повлиять на её скорость из приложения.
А соотношение времени затрачиваемого на переключения потоков к времени бизнес логики начитает стремительно расти.

Решение такой проблемы требовало избавиться от обилия переключения потоков.
Для этого нужно сделать как минимум операции чтения неблокирующими.

# Реально читать, только если есть что читать

Переводим сокет в неблокирующий режим:

```c
fcntl(socketfd, F_SETFL, O_NONBLOCK);
```

Ловим:

```
Unable to accept: 11
```

То есть ошибку EAGAIN - Resource temporarily unavailable

Также может вернуться EWOULDBLOCK, чёткой границы нет, нужно быть готовыми получить любую из них.
